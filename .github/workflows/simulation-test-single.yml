name: Single Simulation Test

on:
  workflow_dispatch:
    inputs:
      seed:
        description: 'Seed value for testing'
        required: true
        type: string
      app: 
        description: 'App name for testing (e.g. assessment, etc.)'
        required: true
        type: string

jobs:
  simulation-test:
    name: Single Simulation Test
    runs-on: self-hosted
    timeout-minutes: 30

    steps:
      - uses: actions/checkout@v3
      - uses: ./.github/actions/setup
      - uses: oven-sh/setup-bun@v2
      
      - run: pnpm build
      - run: pnpm install

      - name: Simulation Test ${{ github.event.inputs.app }}
        run: |
          cd simulation-test
          pnpm test ${{ github.event.inputs.app }}
        env:
          SEED: ${{ github.event.inputs.seed }}
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          PONDER_RPC_URL_1: ${{ secrets.PONDER_RPC_URL_1 }}
          PONDER_RPC_URL_10: ${{ secrets.PONDER_RPC_URL_10 }}
          PONDER_RPC_URL_130: ${{ secrets.PONDER_RPC_URL_130 }}
          PONDER_RPC_URL_8453: ${{ secrets.PONDER_RPC_URL_8453 }}
          PGDATABASE: railway
          PGSSLMODE: disable
          PONDER_LOG_LEVEL: debug

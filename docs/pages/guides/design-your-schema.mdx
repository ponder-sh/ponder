---
description: "A guide to defining a Ponder schema"
---

import { Callout } from "nextra-theme-docs";

# Design your schema

The `ponder.schema.ts` file defines your application's database schema, _and_ the autogenerated GraphQL API schema. Like [Zod](https://github.com/colinhacks/zod) and [Drizzle](https://orm.drizzle.team/), the schema definition API uses TypeScript to offer static validation and editor autocompletion throughout your app.

Here's an example `ponder.schema.ts` file for a simple ERC20 app.

```ts filename="ponder.schema.ts"
import { p } from "@ponder/core";

export default p.createSchema({
  Account: p.createTable({
    id: p.string(),
    balance: p.bigint(),
    isOwner: p.boolean(),
    approvals: p.virtual("Approval.ownerId"),
    transferFromEvents: p.virtual("TransferEvent.fromId"),
    transferToEvents: p.virtual("TransferEvent.toId"),
  }),
  Approval: p.createTable({
    id: p.string(),
    amount: p.bigint(),
    ownerId: p.string().references("Account.id"),
    spender: p.string(),
  }),
  TransferEvent: p.createTable({
    id: p.string(),
    amount: p.bigint(),
    fromId: p.string().references("Account.id"),
    toId: p.string().references("Account.id"),
    timestamp: p.int(),
  }),
});
```

## Column types

To create a table, add the table name as a property in the object passed to `p.createSchema(){:ts}`. Then, use `p.createTable(){:ts}` and include column definitions following the same pattern.

Every table _must_ have an `id` column that is a `string`, `bytes`, `int`, or `bigint`.

### Primitive types

Every column is a `string`, `bytes`, `int`, `float`, `bigint`, or `boolean`. Each of these primitive types corresponds to a TypeScript type (used in indexing function code) and a JSON data type (returned by the GraphQL API).

| name               | description                                 | TypeScript type | JSON data type |
| :----------------- | :------------------------------------------ | :-------------- | :------------- |
| `p.string(){:ts}`  | A UTF‐8 character sequence                  | `string`        | `string`       |
| `p.bytes(){:ts}`   | A UTF‐8 character sequence with `0x` prefix | `0x${string}`   | `string`       |
| `p.int(){:ts}`     | A signed 32‐bit integer                     | `number`        | `number`       |
| `p.float(){:ts}`   | A signed floating-point value               | `number`        | `number`       |
| `p.bigint(){:ts}`  | A signed integer (solidity `int256`)        | `bigint`        | `string`       |
| `p.boolean(){:ts}` | `true` or `false`                           | `boolean`       | `boolean`      |

Here's an example `Account` table that has a column of every type, and a function that inserts an `Account` record.

<div className="code-columns">

```ts filename="ponder.schema.ts"
import { p } from "@ponder/core";

export default p.createSchema({
  Account: p.createTable({
    id: p.bytes(),
    daiBalance: p.bigint(),
    totalUsdValue: p.float(),
    lastActiveAt: p.int(),
    isAdmin: p.boolean(),
    graffiti: p.string(),
  }),
});
```

```ts filename="src/index.ts"
const { Account } = context.models;

await Account.create({
  id: "0xabc",
  data: {
    daiBalance: 7770000000000000000n,
    totalUsdValue: 17.38,
    lastActiveAt: 1679337733,
    isAdmin: true,
    graffiti: "LGTM",
  },
});
```

</div>

### Enums

To define a enum, pass a list of allowable values to `p.createEnum(){:ts}` (similar to `p.createTable(){:ts}`). Then use `p.enum(){:ts}` as a column type, passing the enum name as an argument. Enums use the same database and JSON types as `string` columns.

<div className="code-columns">

```ts filename="ponder.schema.ts"
import { p } from "@ponder/core";

export default p.createSchema({
  Color: p.createEnum(["ORANGE", "BLACK"]),
  Cat: p.createTable({
    id: p.string(),
    color: p.enum("Color"),
  }),
});
```

```ts filename="src/index.ts"
const { Cat } = context.models;

await Cat.create({
  id: "Fluffy",
  data: {
    color: "ORANGE",
  },
});
```

</div>

### Lists

To define a list, add `.list(){:ts}` to any primitive or enum column. Lists should only be used for small one-dimenional collections, not relationships between records.

<div className="code-columns">

```ts filename="ponder.schema.ts"
import { p } from "@ponder/core";

export default p.createSchema({
  Color: p.createEnum(["ORANGE", "BLACK"]),
  FancyCat: p.createTable({
    id: p.string(),
    colors: p.enum("Color").list(),
    favoriteNumbers: p.int().list(),
  }),
});
```

```ts filename="src/index.ts"
const { FancyCat } = context.models;

await FancyCat.create({
  id: "Fluffy",
  data: {
    colors: ["ORANGE", "BLACK"],
    favoriteNumbers: [7, 420, 69],
  },
});
```

</div>

### Foreign keys (`references`)

To define a relationship between two tables, create a foreign key column. To create a foreign key column:

1. Use an `Id` suffix in the column name, like `userId` or `tokenId`.
2. Add `.references("OtherTable.id"){:ts}` to the column type, passing the name of the referenced table.column.
3. Be sure that the column type matches the type of the `id` column of the referenced table (`string`, `bytes`, `int`, or `bigint`).

Suppose every `Dog` belongs to a `Person`. When you insert a `Dog` record, set the `ownerId` field to the `id` of a `Person` record to establish the relationship.

<div className="code-columns">

```ts filename="ponder.schema.ts" {5,10}
import { p } from "@ponder/core";

export default p.createSchema({
  Person: p.createTable({
    id: p.string(),
    age: p.int(),
  }),
  Dog: p.createTable({
    id: p.string(),
    ownerId: p.string().references("Person.id"),
  }),
});
```

```ts filename="src/index.ts"
const { Person, Dog } = context.models;

await Person.create({
  id: "Bob",
  data: { age: 22 },
});

await Dog.create({
  id: "Chip",
  data: { ownerId: "Bob" },
});
```

</div>

Now, you can query for information about the owner of a `Dog` using the GraphQL API.

<div className="code-columns">

{/* prettier-ignore */}
```graphql filename="Query"
query {
  dog(id: "Chip") {
    id
    owner {
      age
    }
  }
}
```

{/* prettier-ignore */}
```json filename="Result"
{
  "dog": {
    "id": "Chip",
    "owner": {
      "age": 22,
    },
  },
}
```

</div>

### Virtual columns

<Callout type="info">
  Virtual columns are similar to Graph Protocol `derivedFrom` or reverse-lookup
  fields.
</Callout>

To create a virtual column, use `p.virtual()` as the column type passing the name of a column that references the current table.

<div className="code-columns">

```ts filename="ponder.schema.ts" {7}
import { p } from "@ponder/core";

export default p.createSchema({
  Person: p.createTable({
    id: p.string(),
    age: p.int(),
    dogs: p.virtual("Dog.ownerId"),
  }),
  Dog: p.createTable({
    id: p.string(),
    ownerId: p.string().references("Person.id"),
  }),
});
```

```ts filename="src/index.ts"
const { Person, Dog } = context.models;

await Person.create({
  id: "Bob",
});

await Dog.create({
  id: "Chip",
  data: { ownerId: "Bob" },
});

await Dog.create({
  id: "Spike",
  data: { ownerId: "Bob" },
});
```

</div>

Now, any `Dog` record with `ownerId: "Bob"` will be present in Bob's `dogs` field.

<div className="code-columns">

{/* prettier-ignore */}
```graphql filename="Query"
query {
  person(id: "Bob") {
    id
    dogs {
      id
    }
  }
}
```

{/* prettier-ignore */}
```json filename="Result"
{
  "person": {
    "id": "Bob",
    "dogs": [
      { "id": "Chip" },
      { "id": "Spike" }
    ]
  }
}
```

</div>

You can't directly get or set the `dogs` field on a `Person` record. Virtual columns don't exist in the database. They are only present when querying data from the GraphQL API.

<div className="code-columns">

```ts filename="src/index.ts"
const { Person } = context.models;

await Person.create({
  id: "Bob",
  // Error, can't set a virtual column.
  data: { dogs: ["Chip", "Bob"] },
});
```

```ts filename="src/index.ts"
const { Person } = context.models;

const bob = await Person.get("Bob");
// `dogs` field is NOT present.
// {
//   id: "Bob"
// }
```

</div>

### Optional

All columns are **required**, e.g. `NOT NULL{:sql}` by default. To mark a column as optional/nullable, add `.optional(){:ts}` to the primitive type.

<div className="code-columns">

```ts filename="ponder.schema.ts" {7}
import { p } from "@ponder/core";

export default p.createSchema({
  User: p.createTable({
    id: p.bytes(),
    ens: p.string(),
    github: p.string().optional(),
  }),
});
```

```ts filename="src/index.ts" {6-7,14}
const { User } = context.models;

await User.create({
  id: "0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045",
  data: {
    ens: "vitalik.eth",
    github: "https://github.com/vbuterin",
  },
});

await User.create({
  id: "0xD7029BDEa1c17493893AAfE29AAD69EF892B8ff2",
  data: {
    ens: "dwr.eth",
  },
});
```

</div>

---
description: "A guide to defining a Ponder schema"
---

import { Callout } from "nextra-theme-docs";

# Add contracts

To add a new contract to your app, use the `contracts` field in `ponder.config.ts`. Ponder fetches raw blockchain data (event logs) for each contract you add, and passes that data to the indexing functions you write.

This guide explains how each contract configuration field works, and suggests patterns for common use cases. See also the `ponder.config.ts` [API reference](/api-reference/config) page.

Here's a quick overview of the fields that you can provide for each contract:

| Field          | Required? | Override by network? |
| :------------- | :-------- | :------------------- |
| **name**       | Yes       | No                   |
| **abi**        | Yes       | No                   |
| **address**    | No        | Yes                  |
| **factory**    | No        | Yes                  |
| **filter**     | No        | Yes                  |
| **startBlock** | No        | Yes                  |
| **endBlock**   | No        | Yes                  |

<Callout type="info">
  This guide omits some import statements from code snippets to avoid
  repetition.
</Callout>

## Contract name

Every contract must have a unique name, provided as a key to the `contracts` object.

```ts filename="ponder.config.ts" {14}
import { createConfig } from "@ponder/core";
import { http } from "viem";

import { BlitmapAbi } from "./abis/Blitmap";

export default createConfig({
  networks: {
    mainnet: {
      chainId: 1,
      transport: http(process.env.PONDER_RPC_URL_1),
    },
  },
  contracts: {
    Blitmap: {
      abi: BlitmapAbi,
      network: "mainnet",
      address: "0x8d04a8c79cEB0889Bdd12acdF3Fa9D207eD3Ff63",
      startBlock: 12439123,
    },
  },
});
```

## ABI

Each contract must have an ABI. Ponder uses ABIType to offer type hints & static validation for contract configuration and indexing function signatures. This means ABIs must be saved in `.ts` files and asserted as constant using `as const`.

For more information, please reference the [ABIType documentation](https://abitype.dev/guide/getting-started#usage).

<div className="code-columns">

```ts filename="abis/Blitmap.ts" {11}
export const BlitmapAbi = [
  { inputs: [], stateMutability: "nonpayable", type: "constructor" },
  {
    inputs: [{ internalType: "address", name: "owner", type: "address" }],
    name: "balanceOf",
    outputs: [{ internalType: "uint256", name: "", type: "uint256" }],
    stateMutability: "view",
    type: "function",
  },
  // ...
] as const;
```

```ts filename="ponder.config.ts" {3, 10}
import { createConfig } from "@ponder/core";

import { BlitmapAbi } from "./abis/Blitmap";

export default createConfig({
  // ...
  contracts: [
    {
      name: "Blitmap",
      abi: BlitmapAbi,
      network: "mainnet",
      address: "0x8d04a8c79cEB0889Bdd12acdF3Fa9D207eD3Ff63",
      startBlock: 12439123,
    },
  ],
});
```

</div>

### Multiple ABIs

It's occasionally useful to provide multiple ABIs for a contract, like when defining a proxy contract that has had multiple implementation contracts. The `mergeAbis` function exported by `@ponder/core` merges ABIs safely by removing duplicates and maintaining strict types.

<Callout type="info">
  See the proxy contracts page for more details on using proxy contracts with
  Ponder.
</Callout>

```ts filename="ponder.config.ts" {1,16}
import { createConfig, mergeAbis } from "@ponder/core";
import { http } from "viem";

import { ERC1967ProxyAbi } from "./abis/ERC1967Proxy";
import { NameRegistryAbi } from "./abis/NameRegistry";

export default createConfig({
  networks: {
    goerli: {
      chainId: 5,
      transport: http(process.env.PONDER_RPC_URL_5),
    },
  },
  contracts: {
    FarcasterNameRegistry: {
      abi: mergeAbis([ERC1967ProxyAbi, NameRegistryAbi]),
      network: "goerli",
      address: "0xe3Be01D99bAa8dB9905b33a3cA391238234B79D1",
      startBlock: 7648795,
    },
  },
});
```

## Network

### Single network

If the contract is only deployed to one network, just pass the network name as a string to the `network` field.

```ts filename="ponder.config.ts" {3,11}
export default createConfig({
  networks: {
    mainnet: {
      chainId: 1,
      transport: http(process.env.PONDER_RPC_URL_1),
    },
  },
  contracts: {
    Blitmap: {
      abi: BlitmapAbi,
      network: "mainnet",
      address: "0x8d04...D3Ff63",
      startBlock: 12439123,
    },
  },
});
```

### Multiple networks

If you'd like to index the same contract (having the same ABI) across multiple networks, pass an object to the `network` field that specifies network-specific options.

```ts filename="ponder.config.ts" {14-22}
import { createConfig } from "@ponder/core";
import { http } from "viem";

import { UniswapV3FactoryAbi } from "./abis/UniswapV3Factory";

export default createConfig({
  networks: {
    mainnet: { chainId: 1, transport: http(process.env.PONDER_RPC_URL_1) },
    base: { chainId: 8453, transport: http(process.env.PONDER_RPC_URL_8453) },
  },
  contracts: {
    UniswapV3Factory: {
      abi: UniswapV3FactoryAbi,
      network: {
        mainnet: {
          address: "0x1F98431c8aD98523631AE4a59f267346ea31F984",
          startBlock: 12369621,
        },
        base: {
          address: "0x33128a8fC17869897dcE68Ed026d694621f6FDfD",
          startBlock: 1371680,
        },
      },
    },
  },
});
```

Now, the indexing functions you write for `UniswapV3Factory` will process events from both mainnet and Base.

The `event` and `context` objects are still strictly typed according to the configuration you provide. The `context.network` object contains information about which network the current event is from.

```ts filename="src/index.ts"
ponder.on("UniswapV3Factory:Ownership", async ({ event, context }) => {
  context.network;
  //      ^? { name: "mainnet", chainId 1 } | { name: "base", chainId 8453 }

  event.log.address;
  //        ^? "0x1F98431c8aD98523631AE4a59f267346ea31F984" | "0x33128a8fC17869897dcE68Ed026d694621f6FDfD"

  if (context.network.name === "mainnet") {
    // Do mainnet-specific stuff!
  }
});
```

### Network override logic

Network-specific configuration uses an override pattern. Any options defined at the top level are the default, and the network-specific objects override those defaults.

All fields other than `abi` can be specified on a per-network basis, including `address`, `factory`, `filter`, `startBlock`, and `endBlock`.

#### Example: Uniswap V3 Factory

The Uniswap V3 factory contract is deployed to the same address on most chains, but has a different address on Base.

```ts filename="ponder.config.ts"
import { createConfig } from "@ponder/core";
import { http } from "viem";

import { UniswapV3FactoryAbi } from "./abis/EntryPoint";

export default createConfig({
  networks: {
    mainnet: { chainId: 1, transport: http(process.env.PONDER_RPC_URL_1) },
    optimism: { chainId: 10, transport: http(process.env.PONDER_RPC_URL_10) },
    base: { chainId: 8453, transport: http(process.env.PONDER_RPC_URL_8453) },
  },
  contracts: {
    UniswapV3Factory: {
      abi: UniswapV3FactoryAbi,
      address: "0x1F98431c8aD98523631AE4a59f267346ea31F984",
      network: {
        // No network-specific address provided for mainnet and Optimism.
        // The default address will be used ("0x5FF137D4b0FDCD49DcA30c7CF57E578a026d2789").
        mainnet: { startBlock: 12369621 },
        optimism: { startBlock: 0 },
        // The network-specific address will be used ("0x5FF137D4b0FDCD49DcA30c7CF57E578a026d2789").
        base: {
          address: "0x33128a8fC17869897dcE68Ed026d694621f6FDfD",
          startBlock: 1371680,
        },
      },
    },
  },
});
```

#### Example: ERC-4337 Entry Point

The ERC-4337 Entry Point contract is deployed to the same address on all networks. In this scenario, we can define the `address` field at the top level.

```ts filename="ponder.config.ts"
import { createConfig } from "@ponder/core";
import { http } from "viem";

import { EntryPointAbi } from "./abis/EntryPoint";

export default createConfig({
  networks: {
    mainnet: { chainId: 1, transport: http(process.env.PONDER_RPC_URL_1) },
    optimism: { chainId: 10, transport: http(process.env.PONDER_RPC_URL_10) },
  },
  contracts: {
    EntryPoint: {
      abi: EntryPointAbi,
      address: "0x1F98431c8aD98523631AE4a59f267346ea31F984",
      network: {
        mainnet: { startBlock: 12369621 },
        optimism: { startBlock: 88234528 },
      },
    },
  },
});
```

## Address

### Single address

The simplest (and most common) option is to pass a single static address.

```ts filename="ponder.config.ts" {17}
import { createConfig } from "@ponder/core";
import { http } from "viem";

import { BlitmapAbi } from "./abis/Blitmap";

export default createConfig({
  networks: {
    mainnet: {
      chainId: 1,
      transport: http(process.env.PONDER_RPC_URL_1),
    },
  },
  contracts: {
    Blitmap: {
      abi: BlitmapAbi,
      network: "mainnet",
      address: "0x8d04a8c79cEB0889Bdd12acdF3Fa9D207eD3Ff63",
      startBlock: 12439123,
    },
  },
});
```

### Multiple addresses

The `address` field also accepts a list of contract addresses.

Use this option if you'd like to index multiple contracts with known addresses that have the same ABI (or share an interface, like ERC721) using the same indexing functions.

<Callout type="info">
  When using this option, `startBlock` is shared across all addresses. It's
  often best to use the earliest deployment block among them.
</Callout>

```ts filename="ponder.config.ts" {17-22}
import { createConfig } from "@ponder/core";
import { http } from "viem";

import { ERC721Abi } from "./abis/ERC721";

export default createConfig({
  networks: {
    mainnet: {
      chainId: 1,
      transport: http(process.env.PONDER_RPC_URL_1),
    },
  },
  contracts: {
    NiceJpegs: {
      abi: ERC721Abi,
      network: "mainnet",
      address: [
        "0x4E1f41613c9084FdB9E34E11fAE9412427480e56", // Terraforms
        "0xBC4CA0EdA7647A8aB7C2061c2E118A18a936f13D", // BAYC
        "0x8a90CAb2b38dba80c64b7734e58Ee1dB38B8992e", // Doodles
        "0x0000000000664ceffed39244a8312bD895470803", // !fundrop
      ],
      startBlock: 12439123,
    },
  },
});
```

### Factory contracts

## Filter

By default, Ponder fetches **all events** emitted by the contracts you define in `ponder.config.ts`.

```ts filename="ponder.config.ts"
import { createConfig } from "@ponder/core";
import { http } from "viem";

import { ERC721Abi } from "./abis/ERC721";

export default createConfig({
  networks: {
    mainnet: {
      chainId: 1,
      transport: http(process.env.PONDER_RPC_URL_1),
    },
  },
  contracts: {
    Blitmap: {
      abi: BlitmapAbi,
      network: "mainnet",
      address: "0x8d04a8c79cEB0889Bdd12acdF3Fa9D207eD3Ff63",
      startBlock: 12439123,
    },
  },
});
```

### Many events

### One event, including arguments

## Block range

<Callout type="info">
  It's annoying to keep track of deployment block numbers. We're working on ways
  to automatically detect them.
</Callout>

```ts filename="ponder.config.ts"
export default createConfig({
  networks: {
    mainnet: {
      chainId: 1,
      transport: http(process.env.PONDER_RPC_URL_1),
    },
  },
  contracts: {
    Blitmap: {
      abi: BlitmapAbi,
      network: "mainnet",
      address: "0x8d04a8c79cEB0889Bdd12acdF3Fa9D207eD3Ff63",
      startBlock: 12439123,
    },
  },
});
```

## Special cases

### Proxy contracts

---
title: "Client"
description: "Query a Ponder app with the `@ponder/client` package."
---

import { Callout, Steps, Tabs } from "nextra/components";

# Client queries

`@ponder/client` and `@ponder/react` are TypeScript client packages for querying a Ponder app with end-to-end type safety and live updates.

## Enable on the server

<Callout type="info">
  Client queries are available starting from version `0.9.0`. Read the
  [migration guide](/docs/migration-guide#090) for more details.
</Callout>

Register the `client` middleware on your Ponder server to enable client queries.

```ts filename="src/api/index.ts" {4,9}
import { db } from "ponder:api";
import schema from "ponder:schema";
import { Hono } from "hono";
import { client, graphql } from "ponder";

const app = new Hono();

app.use("/graphql", graphql({ db, schema }));
app.use(client({ db }));

export default app;
```

## `@ponder/client`

The `@ponder/client` package works in any JavaScript environment, including the browser, server-side scripts, and both client and server code from web frameworks like Next.js. If you're using a React framework, use the [`@ponder/react`](#query-from-react) package instead.

### Guide

<Steps>

#### Installation

Install the `@ponder/client` package in your client project.

{/* prettier-ignore */}
<Tabs items={["pnpm", "yarn", "npm"]}>
  <Tabs.Tab>
    ```bash filename="shell"
    pnpm add @ponder/client
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash filename="shell"
    yarn add @ponder/client
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash filename="shell"
    npm add @ponder/client
    ```
  </Tabs.Tab>
</Tabs>

#### Setup client

Create a client using the URL of your Ponder server. Import your Ponder schema into the same file.

```ts {4}
import { createClient } from "@ponder/client";
import * as schema from "../../ponder/ponder.schema";

const client = createClient("http://localhost:42069", { schema });
```

#### Run a query

Use the `client.db` method to execute a `SELECT` statement using Drizzle. The query builder is fully type-safe to provide static query validation and inferred result types.

```ts {6}
import { createClient } from "@ponder/client";
import * as schema from "../../ponder/ponder.schema";

const client = createClient("https://...", { schema });

const result = await client.db.select().from(schema.account).limit(10);
```

</Steps>

### API Reference

#### `client.db`

This method uses server side query validation and a database session with strict query limits. It provides a Drizzle query builder, similar to [API functions](/docs/query/api-functions#query-the-database).

```ts
import { createClient } from "@ponder/client";
import * as schema from "../../ponder/ponder.schema";

const client = createClient("https://...", { schema });

const result = await client.db.select().from(schema.account).limit(10);
```

#### `client.live`

Subscribe to live updates.

When you initiate a live query, the client opens a persistent HTTP connection with the server using Server-Sent Events (SSE). Then, the server notifies the client whenever a new block gets indexed. If a query result is no longer valid, the client will immediately refetch it to receive the latest result. This approach achieves low-latency updates with minimal network traffic.

To avoid browser quotas, each `client` instance uses at most one SSE connection at a time.

```ts
import { createClient } from "@ponder/client";
import * as schema from "../../ponder/ponder.schema";

const client = createClient("https://...", { schema });

const { unsubscribe } = client.live(
  (db) => db.select().from(schema.account),
  (result) => {
    // ...
  },
  (error) => {
    // ...
  }
);
```

#### `client.getStatus()`

Get the indexing progress of each chain.

```ts
import { createClient } from "@ponder/client";
import * as schema from "../../ponder/ponder.schema";

const client = createClient("https://...", { schema });

const status = await client.getStatus();
```

## Query from React

The `@ponder/react` package includes React hooks for subscribing to live updates from your database. It uses `@ponder/client` and Tanstack Query under the hood.

```ts filename="components/Deposits.tsx"
import { usePonderQuery } from "@ponder/react";

const { data, isError, isPending } = usePonderQuery({
  queryFn: (db) => db.select().from(schema.depositEvent).limit(10),
});
```

### TanStack Query

[TanStack Query](https://tanstack.com/query) is a popular library for managing async state in React. It provides powerful features like background updates, caching, and prefetching.

**Queries** are used to fetch data and each query is identified by a unique `queryKey`.

### Guide

<Steps>

#### Installation

Install `@ponder/react` and peer dependencies in your React project.

{/* prettier-ignore */}
<Tabs items={["pnpm", "yarn", "npm"]}>
  <Tabs.Tab>
```bash filename="shell"
pnpm add @ponder/react @ponder/client @tanstack/react-query
```
</Tabs.Tab>
  <Tabs.Tab>
```bash filename="shell"
yarn add @ponder/react @ponder/client @tanstack/react-query
```
</Tabs.Tab>
  <Tabs.Tab>
```bash filename="shell"
npm add @ponder/react @ponder/client @tanstack/react-query
```
</Tabs.Tab>
</Tabs>

#### Create client

Create a client object using the URL of your Ponder server. Import your schema into the same file using a relative import from your `ponder.schema.ts` file.

```ts filename="lib/ponder.ts"
import { createClient } from "@ponder/client";
import * as schema from "../../ponder/ponder.schema";

const client = createClient("http://localhost:42069", { schema });

export { client, schema };
```

#### Wrap app in provider

Wrap your app with the `PonderProvider` React Context Provider and include the client object you just created.

```ts filename="app.tsx" {6-8}
import { PonderProvider } from '@ponder/react'
import { client } from './lib/ponder'

function App() {
  return (
    <PonderProvider client={client}>
      {/** ... */}
    </PonderProvider>
  )
}
```

#### Setup TanStack Query

Inside the `PonderProvider`, wrap your app in a TanStack Query React Context Provider. [Read more](https://tanstack.com/query/latest/docs/framework/react/quick-start) about setting up TanStack Query.

```ts filename="app.tsx" {5, 10-12}
import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
import { PonderProvider } from '@ponder/react'
import { client } from './lib/ponder'

const queryClient = new QueryClient()

function App() {
  return (
    <PonderProvider client={client}>
      <QueryClientProvider client={queryClient}>
        {/** ... */}
      </QueryClientProvider>
    </PonderProvider>
  )
}
```

#### Use the hook

```ts filename="components/Deposits.tsx"
import { usePonderQuery } from '@ponder/react'
import { schema } from '../lib/ponder'

export function Deposits() {
  const { data, isError, isPending } = usePonderQuery({
    queryFn: (db) =>
      db.select()
        .from(schema.depositEvent)
        .orderBy(schema.depositEvent.timestamp)
        .limit(10),
  });

  if (isPending) return <div>Loading deposits</div>
  if (isError) return <div>Error fetching deposits</div>
  return <div>Deposits: {data}</div>
}
```

</Steps>

### API Reference

#### `usePonderQuery`

Hook for querying a Ponder app with live updates.

```ts
import { usePonderQuery } from "@ponder/react";

const { data } = usePonderQuery({
  queryFn: (db) =>
    db
      .select()
      .from(schema.depositEvent)
      .orderBy(schema.depositEvent.timestamp)
      .limit(10),
});
```

#### `usePonderStatus`

Hook for querying the indexing status of each chain.

```ts
import { usePonderStatus } from "@ponder/react";

const { data } = usePonderStatus();
```

#### `getPonderQueryOptions`

Helper function for calculating the query function and query key from a Ponder query.

<Callout type="info">
  Use `getPonderQueryOptions` in a Next.js app to prefetch data on the server.
  [Read
  more](https://github.com/ponder-sh/ponder/blob/v0.9/examples/with-nextjs/frontend/app/page.tsx#L11).
</Callout>

```ts
import { getPonderQueryOptions } from "@ponder/react";

const { queryFn, queryKey } = getPonderQueryOptions(client, (db) =>
  db.select().from(schema.depositEvent).limit(10)
);
```

#### `getQueryKey`

Helper function for calculating the query key from a Ponder query.

```ts
import { getQueryKey } from "@ponder/react";

const key = getQueryKey(db.select().from(schema.depositEvent).limit(10));
```

#### `PonderProvider`

React Context Provider for Ponder.

```tsx
import { PonderProvider } from "@ponder/react";
import { client } from "./lib/ponder";

function App() {
  return <PonderProvider client={client}>{/** ... */}</PonderProvider>;
}
```

## Example projects

These example apps demonstrate how to use `@ponder/client` and `@ponder/react`.

- [**Basic**](https://github.com/ponder-sh/ponder/blob/main/examples/with-client/client/src/index.ts)
- [**Next.js**](https://github.com/ponder-sh/ponder/blob/main/examples/with-nextjs/frontend/src/pages/index.tsx#L11-L18)
